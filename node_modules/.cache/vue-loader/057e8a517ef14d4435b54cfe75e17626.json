{"remainingRequest":"/Users/pwm/www/ui/ShopOA/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/pwm/www/ui/ShopOA/src/components/MtMessage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/pwm/www/ui/ShopOA/src/components/MtMessage.vue","mtime":1561600366122},{"path":"/Users/pwm/www/ui/ShopOA/node_modules/cache-loader/dist/cjs.js","mtime":1561365392055},{"path":"/Users/pwm/www/ui/ShopOA/node_modules/babel-loader/lib/index.js","mtime":1561365391859},{"path":"/Users/pwm/www/ui/ShopOA/node_modules/cache-loader/dist/cjs.js","mtime":1561365392055},{"path":"/Users/pwm/www/ui/ShopOA/node_modules/vue-loader/lib/index.js","mtime":1561365398190}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport config from '../config'\nimport { mapActions } from 'vuex';\nimport axios from 'axios'\nimport { setTimeout } from 'timers';\nexport default {\n    props:{\n        form:{\n            type:Object,\n            default:()=>{\n                return {\n\n                }\n            }\n        },\n        newForm:{\n            type: Object,\n            default:() => {\n                return{\n\n                }\n            }\n        },\n        dialogFormVisible:{\n            type:Boolean,\n            default:()=>{\n                return false\n            }\n        }\n    },\n    data(){\n        return{\n            dialogImageUrl: '',\n            dialogVisible: false,\n            fileList:[],\n            file:{},\n            imgs:[]\n        }\n    },\n    methods:{\n        ...mapActions(['getAliyunPara', 'postImg']),\n        handleRemove(file, fileList) {\n            console.log(file, fileList);\n        },\n        handlePictureCardPreview(file) {\n            this.dialogImageUrl = file.url;\n            this.dialogVisible = true;\n            console.log(file);\n            \n        },\n        imgCallBack(e){\n\n        //定义唯一的文件名，打印出来的uid其实就是时间戳\n        \n        \n            const client = new OSS.Wrapper({\n                                region: e.endpoint,\n                                accessKeyId: e.accessId,//填入自己的id\n                                accessKeySecret: e.accessSecret,//填入自己的id\n                                bucket: e.bucket,\n                                stsToken: localStorage.getItem('token')\n                            })\n                             console.log(this.file.file);\n              const contens = this.file['name'].split('.');\n              \n             const ext = contens[contens.length - 1];\n             const filename = `/shopImg/${Math.random().toString(36).substr(2)}.${ext}`;\n             \n             \n            // var signUrl = client.signatureUrl(filename, {expires: 6000, 'process' : 'image/resize,w_300'});\n            // console.log(signUrl);\n           \n            \n            const ret = client.multipartUpload(filename, this.file.file, {}).then((result) => {\n                console.log(result);\n                \n                vm.$message({\n                type: 'success',\n                message: '图片上传成功',\n                });\n            }).catch((err) => {\n                console.log(err);\n            });\n        },\n        Upload(file) {\n\n            this.file = file.file\n            setTimeout(()=>{\n                this.getAliyunPara( this.imgCallBack);\n            })\n            \n            \n        //    console.log(file.file);\n        //    this.$store.state.file =  Object.assign({},file,{drive:'oss'})\n        //    this.postImg(this.upCallBack)\n\n            let mfile = file.file;\n            let param = new FormData(); //创建form对象\n            param.append('file',mfile);//通过append向form对象添加数据\n            \n            let config = {\n            headers:{'Content-Type':'multipart/form-data'}\n            }; //添加请求头\n            axios.post('http://admin.qiandengli.com/file/images',param,config)\n            .then(response=>{\n                console.log(response.data.data.url);\n                this.imgs.push(response.data.data.url)\n            })\n\n             \n        },\n        upCallBack(e){\n\n        },\n        tabClick(e){\n            if (e === 0) {\n                this.$router.push('/shopList')\n            } \n            else if(e === 1) {\n                this.$emit('changeTab',0)\n            }\n            else if(e === 2) {\n                this.$emit('changeTab',2)\n            }else {\n                 this.$emit('changeTab',2)\n                this.$store.state.ImgVideo.images = [].concat(this.imgs)\n            }\n        }\n     \n      \n    },\n    created(){\n        \n    }\n}\n",{"version":3,"sources":["MtMessage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA","file":"MtMessage.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div class=\"mt-form-ctn\">\n        <el-form ref=\"form\" :model=\"form\" label-width=\"80px\">\n            <el-form-item label=\"商品图片\">\n               <el-upload\n                    action=\"\"\n                    :http-request=\"Upload\" \n                    list-type=\"picture-card\"\n                    :on-preview=\"handlePictureCardPreview\"\n                    :on-remove=\"handleRemove\">\n                    <i class=\"el-icon-plus\"></i>\n                </el-upload>\n                <el-dialog :visible.sync=\"dialogVisible\" size=\"tiny\">\n                    <img width=\"100%\" :src=\"dialogImageUrl\" alt=\"\">\n                </el-dialog>\n                <p class=\"ys-tip-text\">至少上传一张商品图片。当前首页商品模板选择了 模板一，主图建议上传375 * 375px的图片，用于展示在商品图为正方形的区域。商家设置 -> 基本信息，商品图片选择了长方形，其它图片建议上传375 * 240px，展示在商品详情页。</p>\n            </el-form-item>\n            <el-form-item label=\"商品视频\">\n               <el-upload\n                class=\"upload-demo\"\n                drag\n                action=\"https://jsonplaceholder.typicode.com/posts/\"\n                multiple>\n                <i class=\"el-icon-upload\"></i>\n                <div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\n                <div class=\"el-upload__tip\" slot=\"tip\">上传视频大小不能超过20M，视频支持格式：mp4, avi, mpeg, quicktime</div>\n                </el-upload>\n            </el-form-item>\n        </el-form>\n        <div class=\"bottom-wrap\">\n            <el-button @click=\"tabClick(0)\"  size = 'mini'>取消</el-button>\n            <el-button @click=\"tabClick(1)\" size = 'mini' type=\"primary\">上一步</el-button>\n            <!-- <el-button @click=\"tabClick(2)\" size = 'mini' type=\"primary\">下一步</el-button> -->\n            <el-button @click=\"tabClick(3)\" size = 'mini' type=\"primary\">保存</el-button>\n        </div>\n    </div>\n</template>\n\n<script>\n\nimport config from '../config'\nimport { mapActions } from 'vuex';\nimport axios from 'axios'\nimport { setTimeout } from 'timers';\nexport default {\n    props:{\n        form:{\n            type:Object,\n            default:()=>{\n                return {\n\n                }\n            }\n        },\n        newForm:{\n            type: Object,\n            default:() => {\n                return{\n\n                }\n            }\n        },\n        dialogFormVisible:{\n            type:Boolean,\n            default:()=>{\n                return false\n            }\n        }\n    },\n    data(){\n        return{\n            dialogImageUrl: '',\n            dialogVisible: false,\n            fileList:[],\n            file:{},\n            imgs:[]\n        }\n    },\n    methods:{\n        ...mapActions(['getAliyunPara', 'postImg']),\n        handleRemove(file, fileList) {\n            console.log(file, fileList);\n        },\n        handlePictureCardPreview(file) {\n            this.dialogImageUrl = file.url;\n            this.dialogVisible = true;\n            console.log(file);\n            \n        },\n        imgCallBack(e){\n\n        //定义唯一的文件名，打印出来的uid其实就是时间戳\n        \n        \n            const client = new OSS.Wrapper({\n                                region: e.endpoint,\n                                accessKeyId: e.accessId,//填入自己的id\n                                accessKeySecret: e.accessSecret,//填入自己的id\n                                bucket: e.bucket,\n                                stsToken: localStorage.getItem('token')\n                            })\n                             console.log(this.file.file);\n              const contens = this.file['name'].split('.');\n              \n             const ext = contens[contens.length - 1];\n             const filename = `/shopImg/${Math.random().toString(36).substr(2)}.${ext}`;\n             \n             \n            // var signUrl = client.signatureUrl(filename, {expires: 6000, 'process' : 'image/resize,w_300'});\n            // console.log(signUrl);\n           \n            \n            const ret = client.multipartUpload(filename, this.file.file, {}).then((result) => {\n                console.log(result);\n                \n                vm.$message({\n                type: 'success',\n                message: '图片上传成功',\n                });\n            }).catch((err) => {\n                console.log(err);\n            });\n        },\n        Upload(file) {\n\n            this.file = file.file\n            setTimeout(()=>{\n                this.getAliyunPara( this.imgCallBack);\n            })\n            \n            \n        //    console.log(file.file);\n        //    this.$store.state.file =  Object.assign({},file,{drive:'oss'})\n        //    this.postImg(this.upCallBack)\n\n            let mfile = file.file;\n            let param = new FormData(); //创建form对象\n            param.append('file',mfile);//通过append向form对象添加数据\n            \n            let config = {\n            headers:{'Content-Type':'multipart/form-data'}\n            }; //添加请求头\n            axios.post('http://admin.qiandengli.com/file/images',param,config)\n            .then(response=>{\n                console.log(response.data.data.url);\n                this.imgs.push(response.data.data.url)\n            })\n\n             \n        },\n        upCallBack(e){\n\n        },\n        tabClick(e){\n            if (e === 0) {\n                this.$router.push('/shopList')\n            } \n            else if(e === 1) {\n                this.$emit('changeTab',0)\n            }\n            else if(e === 2) {\n                this.$emit('changeTab',2)\n            }else {\n                 this.$emit('changeTab',2)\n                this.$store.state.ImgVideo.images = [].concat(this.imgs)\n            }\n        }\n     \n      \n    },\n    created(){\n        \n    }\n}\n</script>\n<style>\n.mt-form-ctn {\n    flex: 1;\n    padding-top: 20px;\n    background-color: #fff;\n}\n.ys-tip-text {\n    font-size: 12px;\n    color: #999;\n    margin-left: 50px;\n}\n.bottom-wrap {\n    margin-top: 40px;\n    height: 30px;\n}\n</style>\n\n"]}]}